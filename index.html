<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>L√∂ner√§knare</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:linear-gradient(135deg,#eef2ff,#f5f3ff);min-height:100vh;padding:16px}
.wrap{max-width:680px;margin:0 auto}
h1{color:#4338ca;font-size:1.5rem;text-align:center}
.sub{color:#6b7280;font-size:.85rem;text-align:center;margin-top:4px}
.warn{background:#fffbeb;border:1px solid #fcd34d;border-radius:12px;padding:12px 16px;display:flex;gap:10px;margin:12px 0}
.warn p{color:#92400e;font-size:.78rem;line-height:1.5}
.tabs{display:flex;gap:8px;margin-bottom:14px}
.tab{flex:1;padding:10px;border-radius:10px;font-size:.85rem;font-weight:600;cursor:pointer;border:1px solid #e5e7eb;background:#fff;color:#6b7280;transition:.15s}
.tab.active{background:#4338ca;color:#fff;border-color:#4338ca}
.card{background:#fff;border-radius:16px;border:1px solid #f3f4f6;margin-bottom:14px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.06)}
.card-header{padding:12px 16px;font-size:.85rem;font-weight:600}
.card-header.indigo{background:#4338ca;color:#fff}
.card-header.purple{background:#7c3aed;color:#fff}
.card-header.light{background:#eef2ff;color:#3730a3;border-bottom:1px solid #e0e7ff}
.proj-btns{padding:14px 16px;display:flex;flex-wrap:wrap;gap:8px}
.proj-btn{padding:8px 14px;border-radius:10px;font-size:.82rem;font-weight:500;cursor:pointer;border:1px solid #e5e7eb;background:#fff;color:#374151;transition:.15s}
.proj-btn:hover{border-color:#a5b4fc}
.proj-btn.active{background:#4338ca;color:#fff;border-color:#4338ca}
.row{display:flex;align-items:center;gap:10px;padding:10px 16px;border-bottom:1px solid #f9fafb}
.row:last-child{border-bottom:none}
.row-label{flex:1}
.row-label .name{font-size:.85rem;font-weight:500;color:#1f2937}
.row-label .meta{font-size:.74rem;color:#9ca3af;margin-top:2px;display:flex;flex-wrap:wrap;gap:4px}
input[type=number]{width:72px;border:1px solid #e5e7eb;border-radius:8px;padding:6px 8px;font-size:.85rem;text-align:center;outline:none}
input[type=number]:focus{border-color:#818cf8;box-shadow:0 0 0 2px #e0e7ff}
.amt{width:110px;text-align:right;font-size:.85rem;font-weight:600;color:#4338ca}
.section-divider{padding:6px 16px;background:#f9fafb;font-size:.72rem;font-weight:700;color:#9ca3af;text-transform:uppercase;letter-spacing:.05em}
.tier-pill{display:inline-flex;padding:2px 7px;border-radius:20px;font-size:.72rem;background:#f3f4f6;color:#6b7280;margin:2px}
.tier-pill.active{background:#4338ca;color:#fff}
.toggle-btn{padding:8px 14px;border-radius:10px;font-size:.78rem;font-weight:600;cursor:pointer;border:1px solid;display:inline-flex;align-items:center;gap:6px;transition:.15s}
.toggle-btn.green-off{border-color:#86efac;background:#fff;color:#15803d}
.toggle-btn.green-on{border-color:#16a34a;background:#16a34a;color:#fff}
.toggle-btn.blue-off{border-color:#93c5fd;background:#fff;color:#1d4ed8}
.toggle-btn.blue-on{border-color:#2563eb;background:#2563eb;color:#fff}
.dot{width:10px;height:10px;border-radius:50%;border:2px solid currentColor;display:inline-block}
.dot.filled{background:currentColor}
.sum-row{display:flex;justify-content:space-between;font-size:.85rem;padding:4px 0}
.sum-row .lbl{color:#6b7280}
.sum-row .val{font-weight:500}
.sum-row .val.red{color:#ef4444}
.sum-row .val.green{color:#16a34a}
.sum-total{display:flex;justify-content:space-between;align-items:center;padding-top:12px;margin-top:4px;border-top:1px solid #f3f4f6}
.sum-total .lbl{font-weight:700;color:#1f2937}
.sum-total .val{font-size:1.2rem;font-weight:800;color:#4338ca}
.anger-wrap{padding:14px 16px}
.anger-wrap label{font-size:.85rem;font-weight:600;color:#374151;display:block;margin-bottom:8px}
.anger-inner{display:flex;align-items:center;gap:12px}
.anger-note{font-size:.82rem;color:#ef4444;font-weight:500}
.bonus-wrap{padding:12px 16px}
.bonus-wrap p{font-size:.74rem;color:#9ca3af;font-weight:600;margin-bottom:8px;text-transform:uppercase;letter-spacing:.04em}
.bonus-btns{display:flex;flex-wrap:wrap;gap:8px}
.gc-bonus-note{font-size:.74rem;color:#16a34a;margin-top:4px}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useMemo} = React;

function fmt(n){return n.toLocaleString("sv-SE",{minimumFractionDigits:2,maximumFractionDigits:2})+" kr"}
function avgComm(arr){if(!arr.length)return 0;return arr.reduce((s,c)=>s+c.commission,0)/arr.length}
function getTierRate(qty,tiers){let r=tiers[0].rate;for(const t of tiers){if(qty>=t.min)r=t.rate;}return r;}
function getGcBonus(qty,gt){let b=0;for(const t of gt){if(qty>=t.min)b=t.bonus;}return b;}

const TELE2_TILLVAL=[
  {id:"tv1",name:"Familjeabonnemang",commission:250},{id:"tv2",name:"V Series & Film 24 m√•n",commission:250},
  {id:"tv3",name:"V Series & Film 12 m√•n",commission:150},{id:"tv4",name:"V Premium 24m√•n",commission:400},
  {id:"tv5",name:"V Premium 12m√•n",commission:200},{id:"tv6",name:"V Sport 24m√•n",commission:300},
  {id:"tv7",name:"V Sport 12m√•n",commission:150},{id:"tv8",name:"V Omteck",commission:75},
  {id:"tv9",name:"V 0m√•n",commission:25},{id:"tv10",name:"TV4 Sport Max 24m√•n",commission:300},
  {id:"tv11",name:"TV4 Sport Max 12m√•n",commission:150},{id:"tv12",name:"TV4 Sport Stor 24m√•n",commission:250},
  {id:"tv13",name:"TV4 Sport Stor 12m√•n",commission:150},{id:"tv14",name:"TV4 Film & Serier 12/24m√•n",commission:50},
  {id:"tv15",name:"TV4 0m√•n",commission:25},{id:"tv16",name:"Syskonabonnemang",commission:50},
  {id:"tv17",name:"Telefoni",commission:100},{id:"tv18",name:"Omteck",commission:125},
];
const TELE2_TILLVAL_LAN=TELE2_TILLVAL.filter(t=>t.name!=="Omteck"||t.id==="tv17");

const DATA=[
  {id:1,name:"Telia Mobil",type:"flat_tiered",bonusTiers:[{min:1,bonus:0},{min:40,bonus:50},{min:60,bonus:100}],categories:[{id:101,name:"Mobilabonnemang",campaigns:[{id:1011,name:"10GB",commission:400},{id:1012,name:"20GB",commission:600},{id:1013,name:"Mobil Obegr√§nsad",commission:800},{id:1014,name:"Mobil Obegr√§nsad Plus",commission:800},{id:1015,name:"Mobil Obegr√§nsad Plus Disney+",commission:800},{id:1016,name:"Mobil Obegr√§nsad Plus Prime",commission:800},{id:1017,name:"Mobil Obegr√§nsad Plus TV4 Play",commission:800},{id:1018,name:"Mobil Obegr√§nsad Plus Max",commission:800},{id:1019,name:"Mobil Obegr√§nsad Plus Netflix",commission:800},{id:1020,name:"Mobil Obegr√§nsad Plus Netflix, Max och Disney+",commission:800},{id:1021,name:"Extra anv√§ndare",commission:400}]}]},
  {id:2,name:"Telia FMC",type:"flat_tiered",bonusTiers:[{min:1,bonus:0},{min:40,bonus:50},{min:60,bonus:100}],categories:[{id:201,name:"Mobilabonnemang",campaigns:[{id:2011,name:"10GB",commission:300},{id:2012,name:"20GB",commission:500},{id:2013,name:"Obegr√§nsad",commission:600},{id:2014,name:"Obegr√§nsad Plus",commission:700},{id:2015,name:"Obegr√§nsad Plus Disney+",commission:700},{id:2016,name:"Obegr√§nsad Plus Amazon Prime",commission:700},{id:2017,name:"Obegr√§nsad Plus TV4 Play Plus",commission:700},{id:2018,name:"Obegr√§nsad Plus HBO Max",commission:700},{id:2019,name:"Obegr√§nsad Plus Netflix",commission:700},{id:2020,name:"Obegr√§nsad Plus Netflix, HBO Max, Disney+",commission:700},{id:2021,name:"Extra anv√§ndare",commission:300}]}]},
  {id:3,name:"Telia VIP Leads",type:"flat",categories:[
    {id:301,name:"Streaming Film",campaigns:[{id:3011,name:"Streaming mer",commission:100},{id:3012,name:"Streaming maxad",commission:125},{id:3013,name:"Streaming mest",commission:175},{id:3014,name:"Film & Serier 250",commission:125},{id:3015,name:"Film & Serier 300",commission:150}]},
    {id:302,name:"Streaming Sport",campaigns:[{id:3021,name:"Lilla sportpaketet",commission:150},{id:3022,name:"Lilla sportpaketet med netflix",commission:150},{id:3023,name:"Stora sportpaketet",commission:250},{id:3024,name:"Stora sportpaketet med netflix",commission:250},{id:3025,name:"St√∂rsta sportpaketet",commission:300},{id:3026,name:"St√∂rsta sportpaketet med netflix",commission:300},{id:3027,name:"All sport 450",commission:175},{id:3028,name:"All hockey 450",commission:175},{id:3029,name:"All sport fr√•n viaplay 299kr",commission:50},{id:3030,name:"All sport fr√•n viaplay 399kr",commission:200}]},
    {id:303,name:"Bredband",campaigns:[{id:3031,name:"BB100",commission:100},{id:3032,name:"BB150",commission:100},{id:3033,name:"BB250",commission:150},{id:3034,name:"BB300",commission:150},{id:3035,name:"BB500",commission:175},{id:3036,name:"BB600",commission:175},{id:3037,name:"BB1000",commission:200},{id:3038,name:"MBH",commission:250}]},
    {id:304,name:"TV",campaigns:[{id:3041,name:"TV Mini",commission:150},{id:3042,name:"TV Mellan",commission:200},{id:3043,name:"TV Max",commission:300}]},
    {id:305,name:"Mobiler",campaigns:[{id:3051,name:"10GB",commission:200},{id:3052,name:"20GB",commission:250},{id:3053,name:"Mobil Obegr√§nsad",commission:300},{id:3054,name:"Mobil Obegr√§nsad Plus",commission:450},{id:3055,name:"Mobil Obegr√§nsad Plus Disney+",commission:450},{id:3056,name:"Mobil Obegr√§nsad Plus Prime",commission:450},{id:3057,name:"Mobil Obegr√§nsad Plus TV4 Play",commission:450},{id:3058,name:"Mobil Obegr√§nsad Plus Max",commission:450},{id:3059,name:"Mobil Obegr√§nsad Plus Netflix",commission:450},{id:3060,name:"Mobil Obegr√§nsad Plus Netflix, Max och Disney+",commission:450},{id:3061,name:"Extra anv√§ndare",commission:250}]},
    {id:306,name:"H√•rdvara",campaigns:[{id:3062,name:"TV Box",commission:100}]},
  ]},
  {id:4,name:"Telia Retention",type:"flat",categories:[
    {id:401,name:"Streaming Film Nyteck",campaigns:[{id:4011,name:"Nyteck Streaming mer",commission:90},{id:4012,name:"Nyteck Streaming maxad",commission:110},{id:4013,name:"Nyteck Streaming mest",commission:145},{id:4014,name:"Nyteck Film & Serier 250",commission:110},{id:4015,name:"Nyteck Film & Serier 300",commission:130}]},
    {id:402,name:"Streaming Sport Nyteck",campaigns:[{id:4021,name:"Nyteck Lilla sportpaketet",commission:130},{id:4022,name:"Nyteck Lilla sportpaketet med netflix",commission:130},{id:4023,name:"Nyteck Stora sportpaketet",commission:240},{id:4024,name:"Nyteck Stora sportpaketet med netflix",commission:240},{id:4025,name:"Nyteck St√∂rsta sportpaketet",commission:270},{id:4026,name:"Nyteck St√∂rsta sportpaketet med netflix",commission:270},{id:4027,name:"Nyteck All sport 450",commission:150},{id:4028,name:"Nyteck All hockey 450",commission:150},{id:4029,name:"Nyteck All sport fr√•n viaplay 299kr",commission:60},{id:4030,name:"Nyteck All sport fr√•n viaplay 399kr",commission:200}]},
    {id:403,name:"Streaming Film F√∂rl√§gning",campaigns:[{id:4031,name:"F√∂rl√§ngning Streaming mer",commission:15},{id:4032,name:"F√∂rl√§ngning Streaming maxad",commission:30},{id:4033,name:"F√∂rl√§ngning Streaming mest",commission:70},{id:4034,name:"F√∂rl√§ngning Film & Serier 250",commission:30},{id:4035,name:"F√∂rl√§ngning Film & Serier 300",commission:30}]},
    {id:404,name:"Streaming Sport F√∂rl√§gning",campaigns:[{id:4041,name:"F√∂rl√§ngning Lilla sportpaketet",commission:30},{id:4042,name:"F√∂rl√§ngning Lilla sportpaketet med netflix",commission:30},{id:4043,name:"F√∂rl√§ngning Stora sportpaketet",commission:45},{id:4044,name:"F√∂rl√§ngning Stora sportpaketet med netflix",commission:45},{id:4045,name:"F√∂rl√§ngning St√∂rsta sportpaketet",commission:60},{id:4046,name:"F√∂rl√§ngning St√∂rsta sportpaketet med netflix",commission:60},{id:4047,name:"F√∂rl√§ngning All sport 450",commission:30},{id:4048,name:"F√∂rl√§ngning All hockey 450",commission:30},{id:4049,name:"F√∂rl√§ngning All sport fr√•n viaplay 299kr",commission:30},{id:4050,name:"F√∂rl√§ngning All sport fr√•n viaplay 399kr",commission:80}]},
    {id:405,name:"TV nyteck",campaigns:[{id:4051,name:"Nyteck TV Mini",commission:150},{id:4052,name:"Nyteck TV Mellan",commission:210},{id:4053,name:"Nyteck TV Max",commission:300}]},
    {id:406,name:"TV f√∂rl√§gning",campaigns:[{id:4061,name:"F√∂rl√§ngning TV Mini",commission:0},{id:4062,name:"F√∂rl√§ngning TV Mellan",commission:70},{id:4063,name:"F√∂rl√§ngning TV Max",commission:100}]},
    {id:407,name:"Bredband",campaigns:[{id:4071,name:"BB100/100 499",commission:60},{id:4072,name:"BB100/100 449",commission:30},{id:4073,name:"BB150/150 499",commission:45},{id:4074,name:"BB150/150 449",commission:30},{id:4075,name:"BB300/300 549",commission:80},{id:4076,name:"BB300/300 499",commission:60},{id:4077,name:"BB300/300 449",commission:40},{id:4078,name:"BB600/600 649",commission:120},{id:4079,name:"BB600/600 599",commission:150},{id:4080,name:"BB600/600 549",commission:90},{id:4081,name:"BB600/600 499",commission:90},{id:4082,name:"BB1000/1000 899",commission:125},{id:4083,name:"BB1000/1000 699",commission:100}]},
    {id:408,name:"Mobilabonnemang",campaigns:[{id:4084,name:"Mobil 10GB",commission:240},{id:4085,name:"Mobil 20GB",commission:300},{id:4086,name:"Mobil Obegr√§nsad",commission:360},{id:4087,name:"Mobil Obegr√§nsad Plus",commission:540},{id:4088,name:"Mobil Obegr√§nsad Plus Disney+",commission:540},{id:4089,name:"Mobil Obegr√§nsad Plus Prime",commission:540},{id:4090,name:"Mobil Obegr√§nsad Plus TV4 Play",commission:540},{id:4091,name:"Mobil Obegr√§nsad Plus Max",commission:540},{id:4092,name:"Mobil Obegr√§nsad Plus Netflix",commission:540},{id:4093,name:"Mobil Obegr√§nsad Plus Netflix, Max och Disney+",commission:540},{id:4094,name:"Extra anv√§ndare",commission:300}]},
    {id:409,name:"H√•rdvara",campaigns:[{id:4095,name:"TV Box",commission:60}]},
  ]},
  {id:5,name:"Telia MBH",type:"flat",categories:[
    {id:501,name:"Bredband",campaigns:[{id:5011,name:"MBB Hemma",commission:400},{id:5012,name:"MBB 70/40 GB",commission:100}]},
    {id:502,name:"TV",campaigns:[{id:5021,name:"TV Mini",commission:125},{id:5022,name:"TV Mellan",commission:200},{id:5023,name:"TV Mycket",commission:250}]},
    {id:503,name:"Streaming Film",campaigns:[{id:5031,name:"Streaming mer",commission:150},{id:5032,name:"Streaming maxad",commission:175},{id:5033,name:"Streaming mest",commission:200},{id:5034,name:"Film & Serier 250",commission:175},{id:5035,name:"Film & Serier 300",commission:200}]},
    {id:504,name:"Streaming Sport",campaigns:[{id:5041,name:"Lilla sportpaketet",commission:200},{id:5042,name:"Lilla sportpaketet med netflix",commission:200},{id:5043,name:"Stora sportpaketet",commission:350},{id:5044,name:"Stora sportpaketet med netflix",commission:350},{id:5045,name:"St√∂rsta sportpaketet",commission:400},{id:5046,name:"St√∂rsta sportpaketet med netflix",commission:400},{id:5047,name:"All sport 450",commission:250},{id:5048,name:"All hockey 450",commission:250},{id:5049,name:"All sport fr√•n viaplay 299kr",commission:150},{id:5050,name:"All sport fr√•n viaplay 399kr",commission:250}]},
    {id:505,name:"Mobilabonnemang",campaigns:[{id:5051,name:"Mobil 10GB",commission:250},{id:5052,name:"Mobil 20GB",commission:350},{id:5053,name:"Mobil Obegr√§nsad",commission:450},{id:5054,name:"Mobil Obegr√§nsad Plus",commission:650},{id:5055,name:"Mobil Obegr√§nsad Plus Disney+",commission:650},{id:5056,name:"Mobil Obegr√§nsad Plus Prime",commission:650},{id:5057,name:"Mobil Obegr√§nsad Plus TV4 Play",commission:650},{id:5058,name:"Mobil Obegr√§nsad Plus Max",commission:650},{id:5059,name:"Mobil Obegr√§nsad Plus Netflix",commission:650},{id:5060,name:"Mobil Obegr√§nsad Plus Netflix, Max och Disney+",commission:650},{id:5061,name:"Extra anv√§ndare",commission:350}]},
    {id:506,name:"H√•rdvara",campaigns:[{id:5062,name:"TV Box",commission:150}]},
  ]},
  {id:6,name:"Telia Adress√§ndring",type:"flat",categories:[
    {id:601,name:"Bredband Flytt",campaigns:[{id:6011,name:"Flytt BB100",commission:45},{id:6012,name:"Flytt BB150",commission:45},{id:6013,name:"Flytt BB250",commission:80},{id:6014,name:"Flytt BB300",commission:80},{id:6015,name:"Flytt BB500",commission:120},{id:6016,name:"Flytt BB600",commission:120},{id:6017,name:"Flytt BB1000",commission:125}]},
    {id:602,name:"TV Flytt",campaigns:[{id:6021,name:"Flytt TV Mini",commission:0},{id:6022,name:"Flytt TV Mellan",commission:70},{id:6023,name:"Flytt TV Max",commission:100}]},
    {id:603,name:"Streaming Film Flytt",campaigns:[{id:6031,name:"Flytt Streaming mer",commission:15},{id:6032,name:"Flytt Streaming maxad",commission:30},{id:6033,name:"Flytt Streaming mest",commission:70},{id:6034,name:"Flytt Film & Serier 250",commission:30},{id:6035,name:"Flytt Film & Serier 300",commission:30}]},
    {id:604,name:"Streaming Sport Flytt",campaigns:[{id:6041,name:"Flytt Lilla sportpaketet",commission:30},{id:6042,name:"Flytt Lilla sportpaketet med netflix",commission:30},{id:6043,name:"Flytt Stora sportpaketet",commission:45},{id:6044,name:"Flytt Stora sportpaketet med netflix",commission:45},{id:6045,name:"Flytt St√∂rsta sportpaketet",commission:60},{id:6046,name:"Flytt St√∂rsta sportpaketet med netflix",commission:60},{id:6047,name:"Flytt All sport 450",commission:30},{id:6048,name:"Flytt All hockey 450",commission:30},{id:6049,name:"Flytt All sport fr√•n viaplay 299kr",commission:30},{id:6050,name:"Flytt All sport fr√•n viaplay 399kr",commission:80}]},
    {id:605,name:"Bredband Nyteck",campaigns:[{id:6051,name:"BB100",commission:100},{id:6052,name:"BB150",commission:100},{id:6053,name:"BB250",commission:150},{id:6054,name:"BB300",commission:150},{id:6055,name:"BB500",commission:175},{id:6056,name:"BB600",commission:175},{id:6057,name:"BB1000",commission:200},{id:6058,name:"MBH",commission:250}]},
    {id:606,name:"TV Nyteck",campaigns:[{id:6061,name:"TV Mini",commission:150},{id:6062,name:"TV Mellan",commission:200},{id:6063,name:"TV Max",commission:300}]},
    {id:607,name:"Streaming Film Nyteck",campaigns:[{id:6071,name:"Streaming mer",commission:100},{id:6072,name:"Streaming maxad",commission:125},{id:6073,name:"Streaming mest",commission:175},{id:6074,name:"Film & Serier 250",commission:125},{id:6075,name:"Film & Serier 300",commission:150}]},
    {id:608,name:"Streaming Sport Nyteck",campaigns:[{id:6081,name:"Lilla sportpaketet",commission:150},{id:6082,name:"Lilla sportpaketet med netflix",commission:150},{id:6083,name:"Stora sportpaketet",commission:250},{id:6084,name:"Stora sportpaketet med netflix",commission:250},{id:6085,name:"St√∂rsta sportpaketet",commission:300},{id:6086,name:"St√∂rsta sportpaketet med netflix",commission:300},{id:6087,name:"All sport 450",commission:175},{id:6088,name:"All hockey 450",commission:175},{id:6089,name:"All sport fr√•n viaplay 299kr",commission:50},{id:6090,name:"All sport fr√•n viaplay 399kr",commission:200}]},
    {id:609,name:"Mobilabonnemang",campaigns:[{id:6091,name:"Mobil 10GB",commission:200},{id:6092,name:"Mobil 20GB",commission:250},{id:6093,name:"Mobil Obegr√§nsad",commission:300},{id:6094,name:"Mobil Obegr√§nsad Plus",commission:450},{id:6095,name:"Mobil Obegr√§nsad Plus Streaming",commission:450},{id:6096,name:"Mobil Obegr√§nsad Max",commission:450},{id:6097,name:"Extra anv√§ndare",commission:250}]},
    {id:610,name:"H√•rdvara",campaigns:[{id:6101,name:"TV Box",commission:100}]},
  ]},
  {id:7,name:"Telia FM",type:"flat",categories:[
    {id:701,name:"Bredband",campaigns:[{id:7011,name:"Bredband 100/100",commission:200},{id:7012,name:"Bredband 150/150",commission:200},{id:7013,name:"Bredband 250/250",commission:300},{id:7014,name:"Bredband 300/300",commission:300},{id:7015,name:"Bredband 500/500",commission:300},{id:7016,name:"Bredband 600/600",commission:300},{id:7017,name:"Bredband 1000/1000",commission:350},{id:7018,name:"Mobilt Bredband Hemma",commission:200}]},
    {id:702,name:"TV",campaigns:[{id:7021,name:"TV Mini",commission:50},{id:7022,name:"TV Mellan",commission:400},{id:7023,name:"TV Mycket",commission:450}]},
    {id:703,name:"Streaming film",campaigns:[{id:7031,name:"TV4 Play Plus",commission:0},{id:7032,name:"Streaming Mer",commission:200},{id:7033,name:"Streaming Maxad",commission:225},{id:7034,name:"Streaming Mest",commission:250},{id:7035,name:"All film & serier fr√•n TV4 Play, Viaplay & Max",commission:200},{id:7036,name:"All Film & Serier Fr√•n Netflix, Tv4 Play, Viaplay & Hbo Max",commission:200},{id:7037,name:"All Film & Serier Fr√•n Netflix, Tv4 Play, Amazon Prime & Hbo Max",commission:250}]},
    {id:704,name:"Streaming Sport",campaigns:[{id:7041,name:"All sport fr√•n viaplay 299kr",commission:50},{id:7042,name:"All sport fr√•n viaplay 399kr",commission:200},{id:7043,name:"TV4 Play Sport Total",commission:225},{id:7044,name:"Tv4 play sport Hockey",commission:225},{id:7045,name:"Lilla sportpaketet",commission:200},{id:7046,name:"Lilla sportpaketet med Netflix",commission:200},{id:7047,name:"Stora sportpaketet",commission:225},{id:7048,name:"Stora sportpaketet med Netflix",commission:225},{id:7049,name:"St√∂rsta sportpaketet",commission:450},{id:7050,name:"St√∂rsta sportpaketet med Netflix",commission:450}]},
    {id:705,name:"Mobilabonnemang",campaigns:[{id:7051,name:"Mobil 10 GB",commission:100},{id:7052,name:"Mobil 20 GB",commission:150},{id:7053,name:"Mobil Obegr√§nsad",commission:250},{id:7054,name:"Mobil Obegr√§nsad Plus",commission:350},{id:7055,name:"Mobil Obegr√§nsad Plus + Netflix/HBO Max / Disney+",commission:200},{id:7056,name:"Mobil Obegr√§nsad Plus + Netflix & HBO Max & Disney+",commission:200},{id:7057,name:"Mobil EA",commission:100}]},
    {id:706,name:"H√•rdvara",campaigns:[{id:7061,name:"TV Box",commission:150}]},
  ]},
  {id:8,name:"Tele2 Koax",type:"tele2",tiers:[{min:1,rate:225},{min:25,rate:275},{min:50,rate:325},{min:75,rate:375},{min:100,rate:400},{min:120,rate:425}],tillval:TELE2_TILLVAL.filter(t=>t.name!=="Omteck"),omteck:{id:"omteck_8",name:"Omteck",commission:125}},
  {id:9,name:"Tele2 Villafiber",type:"tele2",tiers:[{min:1,rate:325},{min:25,rate:375},{min:50,rate:425},{min:75,rate:475},{min:100,rate:500},{min:120,rate:525}],tillval:TELE2_TILLVAL},
  {id:10,name:"Tele2 LAN",type:"tele2",tiers:[{min:1,rate:250},{min:25,rate:300},{min:50,rate:350},{min:75,rate:400},{min:100,rate:425},{min:120,rate:450}],tillval:TELE2_TILLVAL_LAN},
  {id:11,name:"GlobalConnect Aktiveringar",type:"gc_akt",tiers:[{min:1,rate:300},{min:31,rate:400},{min:61,rate:500},{min:91,rate:600}]},
  {id:12,name:"GlobalConnect",type:"gc",categories:[
    {id:1201,name:"Upsell",tiers:[{min:1,rate:600},{min:20,rate:700},{min:30,rate:900},{min:40,rate:1000},{min:50,rate:1100},{min:60,rate:1200}],gcGreenTiers:[{min:1,bonus:0},{min:20,bonus:50},{min:30,bonus:100},{min:40,bonus:150},{min:60,bonus:200}]},
    {id:1202,name:"Byggs√§lj",tiers:[{min:1,rate:500},{min:20,rate:600},{min:30,rate:800},{min:40,rate:900},{min:50,rate:1000},{min:60,rate:1100}],gcGreenTiers:[{min:1,bonus:0},{min:20,bonus:50},{min:30,bonus:100},{min:40,bonus:150},{min:60,bonus:200}]},
    {id:1203,name:"Nys√§lj",tiers:[{min:1,rate:350},{min:20,rate:450},{min:30,rate:500},{min:40,rate:550},{min:50,rate:600},{min:60,rate:700}],gcGreenTiers:[{min:1,bonus:0},{min:20,bonus:50},{min:30,bonus:100},{min:40,bonus:150},{min:60,bonus:200}]},
    {id:1204,name:"Tj√§nstebundling (ej Telia)",flat:400},
  ]},
];

function App(){
  const [selId,setSelId]=useState(null);
  const [sales,setSales]=useState({});
  const [anger,setAnger]=useState("");
  const [greenBonus,setGreenBonus]=useState(false);
  const [angerBonus,setAngerBonus]=useState(false);
  const [gcGreen,setGcGreen]=useState(false);

  const project=DATA.find(p=>p.id===selId);
  const angerPct=parseFloat(anger)||0;
  function q(id){return parseInt(sales[id])||0;}
  function setSale(id,val){setSales(p=>({...p,[id]:val}));}

  const gross=useMemo(()=>{
    if(!project)return 0;
    if(project.type==="flat"||project.type==="flat_tiered"){
      const base=project.categories.reduce((s,cat)=>s+q(cat.id)*avgComm(cat.campaigns),0);
      if(project.type==="flat_tiered"){
        const totalQty=project.categories.reduce((s,cat)=>s+q(cat.id),0);
        const bonus=getGcBonus(totalQty,project.bonusTiers);
        return base+totalQty*bonus;
      }
      return base;
    }
    if(project.type==="tele2"){
      const pQty=q("prod_"+project.id);
      const bonus=(greenBonus?25:0)+(angerBonus?25:0);
      const rate=pQty>0?getTierRate(pQty,project.tiers)+bonus:0;
      const tillvalAvg=avgComm(project.tillval);
      const tillvalQty=q("tillval_"+project.id);
      const omteckGross=project.omteck?q(project.omteck.id)*project.omteck.commission:0;
      return pQty*rate+tillvalQty*tillvalAvg+omteckGross;
    }
    if(project.type==="gc_akt"){
      const pQty=q("gc_akt_"+project.id);
      return pQty>0?pQty*getTierRate(pQty,project.tiers):0;
    }
    if(project.type==="gc"){
      return project.categories.reduce((s,cat)=>{
        if(cat.flat!==undefined)return s+q(cat.id)*cat.flat;
        const qty=q(cat.id);
        const rate=qty>0?getTierRate(qty,cat.tiers):0;
        const bonus=gcGreen&&qty>0?getGcBonus(qty,cat.gcGreenTiers):0;
        return s+qty*(rate+bonus);
      },0);
    }
    return 0;
  },[project,sales,greenBonus,angerBonus,gcGreen]);

  const angerDed=gross*(angerPct/100);
  const afterAnger=gross-angerDed;
  const holiday=afterAnger*0.12;
  const total=afterAnger+holiday;

  function selectProject(id){setSelId(id);setSales({});setGreenBonus(false);setAngerBonus(false);setGcGreen(false);}

  function TierPills({tiers,qty}){
    return tiers.map((t,i)=>{
      const isActive=qty>=t.min&&(i===tiers.length-1||qty<tiers[i+1].min);
      return <span key={i} className={"tier-pill"+(isActive?" active":"")}>{t.min}+: {t.rate} kr</span>;
    });
  }

  function ToggleBtn({active,onClick,label,color}){
    const cls=color==="green"?(active?"toggle-btn green-on":"toggle-btn green-off"):(active?"toggle-btn blue-on":"toggle-btn blue-off");
    return <button className={cls} onClick={onClick}><span className={"dot"+(active?" filled":"")}></span>{label}</button>;
  }

  function SumRow({label,value,color}){
    return <div className="sum-row"><span className="lbl">{label}</span><span className={"val"+(color?" "+color:"")}>{value}</span></div>;
  }

  return (
    <div className="wrap">
      <h1>L√∂ner√§knare</h1>
      <p className="sub">R√§kna ut din provision och uppskattade l√∂n</p>
      <div className="warn">
        <span>‚ö†Ô∏è</span>
        <p>L√∂nen ber√§knas utifr√•n <strong>snittprovision</strong> per kategori och tillval. Den faktiska l√∂nen kan skilja sig beroende p√• exakt vilka kampanjer som s√•lts. Se detta som en uppskattning.</p>
      </div>

      <div className="card">
        <div className="card-header light">V√§lj projekt</div>
        <div className="proj-btns">
          {DATA.map(p=>(
            <button key={p.id} className={"proj-btn"+(selId===p.id?" active":"")} onClick={()=>selectProject(p.id)}>{p.name}</button>
          ))}
        </div>
      </div>

      {project && (<>
        {project.type==="tele2" && (
          <div className="card">
            <div className="bonus-wrap">
              <p>Bonusar ‚Äî klicka f√∂r att aktivera</p>
              <div className="bonus-btns">
                <ToggleBtn active={greenBonus} onClick={()=>setGreenBonus(v=>!v)} label="üü¢ Gr√∂n kampanj bonus? (+25 kr/produkt)" color="green"/>
                <ToggleBtn active={angerBonus} onClick={()=>setAngerBonus(v=>!v)} label="‚úÖ √Önger under 15%? (+25 kr/produkt)" color="blue"/>
              </div>
            </div>
          </div>
        )}
        {project.type==="gc" && (
          <div className="card">
            <div className="bonus-wrap">
              <p>Bonus ‚Äî klicka f√∂r att aktivera</p>
              <div className="bonus-btns">
                <ToggleBtn active={gcGreen} onClick={()=>setGcGreen(v=>!v)} label="üü¢ Gr√∂n kampanj bonus?" color="green"/>
              </div>
            </div>
          </div>
        )}

        <div className="card">
          <div className="card-header indigo">{project.name} ‚Äî Fyll i antal s√•lda</div>

          {(project.type==="flat"||project.type==="flat_tiered") && (()=>{
            const totalQty=project.type==="flat_tiered"?project.categories.reduce((s,cat)=>s+q(cat.id),0):0;
            const bonus=project.type==="flat_tiered"?getGcBonus(totalQty,project.bonusTiers):0;
            return (<>
              {project.categories.map(cat=>(
                <div className="row" key={cat.id}>
                  <div className="row-label">
                    <div className="name">{cat.name}</div>
                    <div className="meta">Snittprovision: {avgComm(cat.campaigns).toLocaleString("sv-SE",{maximumFractionDigits:0})} kr ({cat.campaigns.length} kampanjer)</div>
                  </div>
                  <input type="number" min="0" placeholder="0" value={sales[cat.id]||""} onChange={e=>setSale(cat.id,e.target.value)}/>
                  <div className="amt">{fmt(q(cat.id)*(avgComm(cat.campaigns)+bonus))}</div>
                </div>
              ))}
              {project.type==="flat_tiered" && (
                <div style={{padding:"10px 16px",background:"#f9fafb",borderTop:"1px solid #f3f4f6"}}>
                  <div style={{fontSize:".78rem",color:"#6b7280",marginBottom:"4px",fontWeight:600}}>Bonustrappa (totalt antal s√•lda: {totalQty})</div>
                  <div style={{display:"flex",flexWrap:"wrap",gap:"4px"}}>
                    {project.bonusTiers.map((t,i)=>{
                      const isActive=totalQty>=t.min&&(i===project.bonusTiers.length-1||totalQty<project.bonusTiers[i+1].min);
                      return <span key={i} className={"tier-pill"+(isActive?" active":"")}>{t.min}+: +{t.bonus} kr/avtal</span>;
                    })}
                  </div>
                  {bonus>0&&<div className="gc-bonus-note" style={{marginTop:"4px"}}>‚úÖ +{bonus} kr bonus per avtal √§r inr√§knat</div>}
                </div>
              )}
            </>);
          })()}

          {project.type==="tele2" && (()=>{
            const pid="prod_"+project.id;
            const pQty=q(pid);
            const bonus=(greenBonus?25:0)+(angerBonus?25:0);
            const rate=pQty>0?getTierRate(pQty,project.tiers)+bonus:0;
            const tillvalAvg=avgComm(project.tillval);
            const tQty=q("tillval_"+project.id);
            return (<>
              <div className="row">
                <div className="row-label">
                  <div className="name">Produkt</div>
                  <div className="meta"><TierPills tiers={project.tiers} qty={pQty}/>{bonus>0&&<span style={{color:"#16a34a",fontSize:".72rem"}}>+{bonus} kr bonus/st</span>}</div>
                </div>
                <input type="number" min="0" placeholder="0" value={sales[pid]||""} onChange={e=>setSale(pid,e.target.value)}/>
                <div className="amt">{fmt(pQty*rate)}</div>
              </div>
              <div className="section-divider">Tillval (r√§knas ej in i trappa)</div>
              <div className="row">
                <div className="row-label">
                  <div className="name">Tillval</div>
                  <div className="meta">Snittprovision: {tillvalAvg.toLocaleString("sv-SE",{maximumFractionDigits:0})} kr ({project.tillval.length} tillval)</div>
                </div>
                <input type="number" min="0" placeholder="0" value={sales["tillval_"+project.id]||""} onChange={e=>setSale("tillval_"+project.id,e.target.value)}/>
                <div className="amt">{fmt(tQty*tillvalAvg)}</div>
              </div>
              {project.omteck && (()=>{
                const oQty=q(project.omteck.id);
                return (
                  <div className="row">
                    <div className="row-label">
                      <div className="name">{project.omteck.name}</div>
                      <div className="meta">Fast: {project.omteck.commission} kr/st</div>
                    </div>
                    <input type="number" min="0" placeholder="0" value={sales[project.omteck.id]||""} onChange={e=>setSale(project.omteck.id,e.target.value)}/>
                    <div className="amt">{fmt(oQty*project.omteck.commission)}</div>
                  </div>
                );
              })()}
            </>);
          })()}

          {project.type==="gc_akt" && (()=>{
            const pid="gc_akt_"+project.id;
            const pQty=q(pid);
            const rate=pQty>0?getTierRate(pQty,project.tiers):0;
            return (
              <div className="row">
                <div className="row-label">
                  <div className="name">Produkt</div>
                  <div className="meta"><TierPills tiers={project.tiers} qty={pQty}/></div>
                </div>
                <input type="number" min="0" placeholder="0" value={sales[pid]||""} onChange={e=>setSale(pid,e.target.value)}/>
                <div className="amt">{fmt(pQty*rate)}</div>
              </div>
            );
          })()}

          {project.type==="gc" && project.categories.map(cat=>{
            if(cat.flat!==undefined){
              return (
                <div className="row" key={cat.id}>
                  <div className="row-label">
                    <div className="name">{cat.name}</div>
                    <div className="meta">Fast: {cat.flat} kr/st</div>
                  </div>
                  <input type="number" min="0" placeholder="0" value={sales[cat.id]||""} onChange={e=>setSale(cat.id,e.target.value)}/>
                  <div className="amt">{fmt(q(cat.id)*cat.flat)}</div>
                </div>
              );
            }
            const qty=q(cat.id);
            const rate=qty>0?getTierRate(qty,cat.tiers):0;
            const bonus=gcGreen&&qty>0?getGcBonus(qty,cat.gcGreenTiers):0;
            return (
              <div className="row" key={cat.id}>
                <div className="row-label">
                  <div className="name">{cat.name}</div>
                  <div className="meta"><TierPills tiers={cat.tiers} qty={qty}/>{gcGreen&&bonus>0&&<span className="gc-bonus-note">üü¢ +{bonus} kr/st</span>}</div>
                </div>
                <input type="number" min="0" placeholder="0" value={sales[cat.id]||""} onChange={e=>setSale(cat.id,e.target.value)}/>
                <div className="amt">{fmt(qty*(rate+bonus))}</div>
              </div>
            );
          })}
        </div>

        <div className="card">
          <div className="anger-wrap">
            <label>√Öngerprocent (%)</label>
            <div className="anger-inner">
              <input type="number" min="0" max="100" step="0.1" placeholder="0.0" value={anger} onChange={e=>setAnger(e.target.value)} style={{width:"120px"}}/>
              {angerPct>0&&<span className="anger-note">‚àí{fmt(angerDed)}</span>}
            </div>
          </div>
        </div>

        <div className="card">
          <div className="card-header purple">Sammanst√§llning</div>
          <div style={{padding:"16px"}}>
            <SumRow label="Bruttoprovision" value={fmt(gross)}/>
            {angerPct>0&&<SumRow label={`√Öngeravdrag (${angerPct}%)`} value={"‚àí"+fmt(angerDed)} color="red"/>}
            <SumRow label="Provision efter √•nger" value={fmt(afterAnger)}/>
            <SumRow label="Semesterers√§ttning (12%)" value={fmt(holiday)} color="green"/>
            <div className="sum-total">
              <span className="lbl">Uppskattad l√∂n</span>
              <span className="val">{fmt(total)}</span>
            </div>
          </div>
        </div>
      </>)}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>